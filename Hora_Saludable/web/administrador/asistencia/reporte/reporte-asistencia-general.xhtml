<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../../../plantillas/frontEndAdministrador.xhtml">

            <ui:define name="titulo">
                Reporte | Asistencia general
            </ui:define>

            <ui:define name="title">
            </ui:define>

            <ui:define name="body">
                <ui:include src="/ventanaEfectodeCarga.xhtml"/>
                <p:breadCrumb>
                    <p:menuitem value="Inicio" url="../../../indexAdministrador.xhtml" />                              
                    <p:menuitem value="Control de asistencia" url="../indexAsistencia.xhtml" />                    
                    <p:menuitem value="Reporte: Asistencia general" outcome="reporte-asistencia-general" />
                </p:breadCrumb>
                
                <p:spacer height="10"/> 
                <div class="tituloContenido">
                    Reporte: Asistencia general
                </div>
                <p:spacer height="20"/>                

                <h:form id="reporteViewForm">
                    <h:panelGroup>
                        <p:panel>
                            <h:panelGrid columns="2" cellpadding="5">
                                <h:outputText value="Tipo de reporte:" />
                                <p:selectOneMenu valueChangeListener="#{reporteView.seleccionarTipo}">
                                    <f:selectItem itemLabel="Seleccione el tipo de reporte" itemValue="Seleccione" />
                                    <f:selectItems value="#{reporteView.tipos}"/>
                                    <f:ajax  execute="tipo" render="reporteViewForm" />
                                </p:selectOneMenu>

                                <h:outputText value="Año:" rendered="#{reporteView.anioRow}" />
                                <p:spinner value="#{reporteView.anio}" rendered="#{reporteView.anioRow}" max="#{reporteView.anio}"/>

                                <h:outputText value="Periodo:" rendered="#{reporteView.periodoRow}" />
                                <p:selectOneMenu value="#{reporteView.perido}" rendered="#{reporteView.periodoRow}" >
                                    <f:selectItem itemLabel="Seleccione el periodo" itemValue="" />
                                    <f:selectItems value="#{reporteView.periodos}" />                                    
                                </p:selectOneMenu>

                                <h:outputText value="Mes:" rendered="#{reporteView.mesRow}" />
                                <p:selectOneMenu value="#{reporteView.mes}" rendered="#{reporteView.mesRow}" >
                                    <f:selectItem itemLabel="Seleccione el mes" itemValue="" />
                                    <f:selectItems value="#{reporteView.meses}" />                                    
                                </p:selectOneMenu>

                                <h:outputText value="Fecha inicial:" rendered="#{reporteView.rangoRow}" />
                                <p:calendar id="fechaIncioCalendar" rendered="#{reporteView.rangoRow}" value="#{reporteView.fechaIncio}" pattern="dd-MM-yyyy" mask="true" mode="popup" showOn="button" locale="es" navigator="true" />

                                <h:outputText value="Fecha final:" rendered="#{reporteView.rangoRow}" />
                                <p:calendar id="fechaFinCalendar" rendered="#{reporteView.rangoRow}" value="#{reporteView.fechaFin}" pattern="dd-MM-yyyy" mask="true" mode="popup" showOn="button" locale="es" navigator="true" />                                
                                <br />
                                <p:commandButton actionListener="#{btnGenerarBean.btnGenerarReporte}" 
                                                 value="Generar Reporte" 
                                                 disabled="#{reporteView.disabledButton}" 
                                                 style="background:#22419A; color: #FFFFFF; " >                                     
                                    <f:attribute name="tipo" value="#{reporteView.tipo}" />  
                                    <f:attribute name="anio" value="#{reporteView.anio}" /> 
                                    <f:attribute name="perido" value="#{reporteView.perido}" />                                      
                                    <f:attribute name="mes" value="#{reporteView.mes}" /> 
                                    <f:attribute name="fechaIncio" value="#{reporteView.fechaIncio}" /> 
                                    <f:attribute name="fechaFin" value="#{reporteView.fechaFin}" /> 
                                </p:commandButton>
                            </h:panelGrid>                            
                        </p:panel> 

                        <p:spacer height="20"/>   

                        <p:panel id="panelChart" widgetVar="PanelChart" rendered="#{btnGenerarBean.mostrarReporte}">
                            <h:panelGrid id="panelGrid2" style="margin: 0 auto;" columns="1" cellpadding="7" > 
                                <p:outputLabel value="Este reporte muestra el número de participantes por mes que asistieron al Programa Hora Saludable" />
                                <p:chart type="bar" model="#{chartViewInscritos.barModel}" style="height:300px" widgetVar="chart"/>
                                <p:commandButton type="button" value="Exportar como imagen" icon="ui-icon-extlink" onclick="exportChart()"/>
                            </h:panelGrid>                   
                        </p:panel>
                    </h:panelGroup>                
                </h:form>

                <p:dialog widgetVar="dlg" showEffect="fade" modal="true" header="Gráfica" resizable="false">
                    <p:outputPanel id="output" layout="block" style="width:610px; height:320px"/>
                </p:dialog>

                <script type="text/javascript">
                    function exportChart() {
                        //export image
                        $('#output').empty().append(PF('chart').exportAsImage());

                        //show the dialog
                        PF('dlg').show();
                    }
                </script>

            </ui:define>
        </ui:composition>
    </body>
</html>